{% extends "base.html" %}

{% block title %}Dashboard - ImobiPro{% endblock %}

{% block content %}
<div class="page-header">
    <h2>üìä Dashboard</h2>
    <p>Vis√£o geral do sistema de gest√£o imobili√°ria</p>
</div>

<!-- Estat√≠sticas principais -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">Total de Im√≥veis</div>
        <div class="stat-value">{{ stats.total_imoveis }}</div>
        <div class="stat-description">Im√≥veis cadastrados</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Im√≥veis Ocupados</div>
        <div class="stat-value" style="color: var(--success);">{{ stats.imoveis_ocupados }}</div>
        <div class="stat-description">Com contratos ativos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Im√≥veis Dispon√≠veis</div>
        <div class="stat-value" style="color: var(--warning);">{{ stats.imoveis_disponiveis }}</div>
        <div class="stat-description">Prontos para loca√ß√£o</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Taxa de Ocupa√ß√£o</div>
        <div class="stat-value" style="color: var(--info);">{{ "%.1f"|format(stats.taxa_ocupacao) }}%</div>
        <div class="stat-description">Percentual ocupado</div>
    </div>
</div>

<!-- Grid de informa√ß√µes -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: var(--spacing-md);">
    
    <!-- Contratos Ativos -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üìã Contratos Ativos</h3>
            <span class="badge badge-success">{{ stats.contratos_ativos }}</span>
        </div>
        
        {% if contratos_ativos %}
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Im√≥vel</th>
                            <th>Inquilino</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for contrato in contratos_ativos %}
                        <tr>
                            <td style="color: var(--text-primary); font-weight: 500;">
                                {{ contrato.imovel_endereco[:40] }}...
                            </td>
                            <td>{{ contrato.inquilino_nome }}</td>
                            <td style="color: var(--success); font-weight: 600;">
                                {{ contrato.valor_aluguel|formatar_moeda }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div style="margin-top: var(--spacing-sm); text-align: center;">
                <a href="{{ url_for('listar_contratos') }}" class="btn btn-secondary">Ver todos os contratos</a>
            </div>
        {% else %}
            <p style="color: var(--text-muted); text-align: center; padding: var(--spacing-lg);">
                Nenhum contrato ativo no momento.
            </p>
        {% endif %}
    </div>
    
    <!-- Im√≥veis Dispon√≠veis -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üèòÔ∏è Im√≥veis Dispon√≠veis</h3>
            <span class="badge badge-warning">{{ stats.imoveis_disponiveis }}</span>
        </div>
        
        {% if imoveis_disponiveis %}
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Endere√ßo</th>
                            <th>Tipo</th>
                            <th>Valor Sugerido</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for imovel in imoveis_disponiveis %}
                        <tr>
                            <td style="color: var(--text-primary); font-weight: 500;">
                                {{ imovel.endereco_completo[:35] }}...
                            </td>
                            <td>{{ imovel.tipo_imovel }}</td>
                            <td style="color: var(--accent); font-weight: 600;">
                                {{ imovel.aluguel_pretendido|formatar_moeda }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div style="margin-top: var(--spacing-sm); text-align: center;">
                <a href="{{ url_for('listar_imoveis') }}?ocupado=N√£o" class="btn btn-secondary">Ver todos dispon√≠veis</a>
            </div>
        {% else %}
            <p style="color: var(--text-muted); text-align: center; padding: var(--spacing-lg);">
                Todos os im√≥veis est√£o ocupados! üéâ
            </p>
        {% endif %}
    </div>
    
    <!-- Despesas Pendentes -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üí∏ Despesas Pendentes</h3>
            <span class="badge badge-danger">{{ stats.despesas_pendentes }}</span>
        </div>
        
        {% if despesas_pendentes %}
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Im√≥vel</th>
                            <th>Valor</th>
                            <th>Situa√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for despesa in despesas_pendentes %}
                        <tr>
                            <td style="color: var(--text-primary); font-weight: 500;">
                                {{ despesa.tipo_despesa }}
                            </td>
                            <td>{{ despesa.imovel[:25] }}...</td>
                            <td style="color: var(--danger); font-weight: 600;">
                                {{ despesa.valor_previsto|formatar_moeda }}
                            </td>
                            <td>
                                <span class="badge badge-{{ 'danger' if despesa.situacao == 'Atrasado' else 'warning' }}">
                                    {{ despesa.situacao }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p style="color: var(--text-muted); text-align: center; padding: var(--spacing-lg);">
                ‚úì Nenhuma despesa pendente!
            </p>
        {% endif %}
    </div>
    
    <!-- Receitas Pendentes -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üí∞ Receitas Pendentes</h3>
            <span class="badge badge-info">{{ stats.receitas_pendentes }}</span>
        </div>
        
        {% if receitas_pendentes %}
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Inquilino</th>
                            <th>Im√≥vel</th>
                            <th>Valor</th>
                            <th>Situa√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for receita in receitas_pendentes %}
                        <tr>
                            <td style="color: var(--text-primary); font-weight: 500;">
                                {{ receita.inquilino }}
                            </td>
                            <td>{{ receita.imovel[:25] }}...</td>
                            <td style="color: var(--success); font-weight: 600;">
                                {{ receita.valor_total_devido|formatar_moeda }}
                            </td>
                            <td>
                                <span class="badge badge-{{ 'danger' if receita.situacao == 'Atrasado' else 'warning' }}">
                                    {{ receita.situacao }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p style="color: var(--text-muted); text-align: center; padding: var(--spacing-lg);">
                ‚úì Nenhuma receita pendente!
            </p>
        {% endif %}
    </div>
</div>

<!-- A√ß√µes r√°pidas -->
<div class="card" style="margin-top: var(--spacing-lg);">
    <div class="card-header">
        <h3 class="card-title">‚ö° A√ß√µes R√°pidas</h3>
    </div>
    <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
        <a href="{{ url_for('novo_imovel') }}" class="btn btn-primary">
            <span>‚ûï</span> Cadastrar Im√≥vel
        </a>
        <a href="{{ url_for('nova_pessoa') }}" class="btn btn-primary">
            <span>‚ûï</span> Cadastrar Pessoa
        </a>
        <a href="#" class="btn btn-success">
            <span>üí∞</span> Lan√ßar Alugu√©is do M√™s
        </a>
        <a href="#" class="btn btn-secondary">
            <span>üìä</span> Gerar Relat√≥rio
        </a>
        <a href="#" class="btn btn-secondary">
            <span>üíæ</span> Fazer Backup
        </a>
    </div>
</div>

{% endblock %}